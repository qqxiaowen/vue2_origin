{"version":3,"file":"vue.js","sources":["../src/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["/*\n * @Date: 2022-07-20 15:14:51\n * @LastEditors: xiaoWen\n * @LastEditTime: 2022-07-20 16:11:32\n * @FilePath: /study-vue/src/array.js\n */\n\nimport { observe } from './observe/index';\n\nconst oldArrayProto = Array.prototype;\nlet newArrayProto = Object.create(oldArrayProto);\nconst methods = ['push', 'pop', 'unshift', 'shift', 'splice', 'reverse'];\nmethods.forEach(methosd => {\n  newArrayProto[methosd] = function (...args) {\n    console.log('methosd', methosd);\n    const result = oldArrayProto[methosd].apply(this, args);\n\n    // 需要对新增的数据进行再次劫持\n    let newData;\n    switch (methosd) {\n      case 'push':\n      case 'unshift':\n        newData = args;\n        break;\n      case 'splice':\n        newData = args.slice(2);\n        break;\n      default:\n        break;\n    }\n    if (newData.length > 0) {\n      console.log('要对数组内新添加的东东做劫持!');\n      // observe(newData);\n      this.__ob__.observerArray(newData);\n    }\n    return result;\n  };\n});\n\nexport default newArrayProto;\n","import newArrayProto from '../array';\n\nexport function observe(data) {\n  if (typeof data !== 'object' || data === null) {\n    return; // 只对对象（引用数据类型）劫持\n  }\n\n  if (data.__ob__ instanceof Observer) {\n    // 说明这个对象已经被代理过了\n    return data.__ob__;\n  }\n\n  // 如果一个对象被劫持过了，那就不需要再被劫持了（可以添加一个实例，来判断是否被劫持）\n  return new Observer(data);\n}\n\nclass Observer {\n  constructor(data) {\n    Object.defineProperty(data, '__ob__', {\n      // 给数据加了个标识，有__ob__，说明已经被观测代理过了\n      value: this,\n      ennumerable: false\n    });\n    if (Array.isArray(data)) {\n      data.__proto__ = newArrayProto;\n      this.observerArray(data); // 观察数组类型，减少基本数据类型的劫持\n    } else {\n      this.walk(data);\n    }\n  }\n  walk(data) {\n    Object.keys(data).forEach(key => defineReactive(data, key, data[key]));\n  }\n  observerArray(data) {\n    data.forEach(item => observe(item));\n  }\n}\n\nexport function defineReactive(target, key, value) {\n  // value属性 闭包\n  observe(value); // 对所有属性都进行劫持-递归\n  // defineProperty \"重新定义\"属性，性能差\n  Object.defineProperty(target, key, {\n    get() {\n      // console.log('用户get', key);\n      return value;\n    },\n    set(newValue) {\n      // console.log('用户set');\n      if (newValue === value) return;\n      observe(newValue); // 应对设置值为新对象的场景\n      value = newValue;\n    }\n  });\n}\n","/*\n * @Date: 2022-07-18 17:28:01\n * @LastEditors: xiaoWen\n * @LastEditTime: 2022-07-18 18:08:49\n * @FilePath: /study-vue/src/state.js\n */\n\nimport { observe } from './observe/index';\n\n// 初始化数据\nexport function initState(vm) {\n  const opts = vm.$option;\n  if (opts.data) {\n    initData(vm);\n  }\n  // if(opts.props) {\n  //   initProps(vm)\n  // }\n}\n\nfunction initData(vm) {\n  let data = vm.$option.data;\n  data = typeof data === 'function' ? data.call(vm) : data;\n  vm._data = data;\n  observe(data);\n\n  // 将vm._data 用vm来代理\n  proxy(vm, data, '_data');\n}\n\nfunction proxy(vm, target, proxyTargetName) {\n  Object.keys(target).forEach(key => {\n    Object.defineProperty(vm, key, {\n      get() {\n        return vm[proxyTargetName][key];\n      },\n      set(newValue) {\n        vm[proxyTargetName][key] = newValue\n      }\n    });\n  });\n}\n","import { initState } from \"./state\";\n\n/*\n * @Date: 2022-07-18 17:03:49\n * @LastEditors: xiaoWen\n * @LastEditTime: 2022-07-18 17:28:05\n * @FilePath: /study-vue/src/init.js\n */\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (option) {\n    const vm = this;\n    vm.$option = option;\n\n    // 初始化状态\n    initState(vm)\n    // todo。。。\n  };\n}\n\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options)\n}\ninitMixin(Vue)\n\n\nexport default Vue;\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","methosd","console","log","args","result","apply","newData","slice","length","__ob__","observerArray","observe","data","Observer","defineProperty","value","ennumerable","isArray","__proto__","walk","keys","key","defineReactive","item","target","get","set","newValue","initState","vm","opts","$option","initData","call","_data","proxy","proxyTargetName","initMixin","Vue","_init","option","options"],"mappings":"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"}